# Workflow Guide

> AI Orchestrator 작업 흐름 상세 가이드

---

## Overview

이 문서는 AI Orchestrator Framework의 주요 워크플로우를 상세히 설명합니다.

---

## 1. Feature Development Workflow

새로운 기능을 개발할 때의 워크플로우입니다.

### 1.1 시작: 사용자 요청

```
사용자: "사용자 프로필 페이지를 추가해주세요"
```

### 1.2 Planner Agent 활성화

1. **요청 분석**
   - 핵심 요구사항 추출
   - 모호한 부분 식별

2. **코드베이스 탐색**
   - 관련 파일 검색
   - 기존 패턴 파악
   - 의존성 확인

3. **영향 범위 분석**
   - 변경이 필요한 파일 목록
   - 영향받는 기능 파악

4. **계획 문서 작성**
   ```markdown
   ## 작업 계획: 사용자 프로필 페이지

   ### 목표
   사용자 프로필 정보를 조회하고 수정할 수 있는 페이지 구현

   ### 영향 범위
   - 새 파일: `src/pages/profile.tsx`
   - 수정 파일: `src/routes/index.ts`

   ### 단계별 계획
   1. [ ] 프로필 페이지 컴포넌트 생성
   2. [ ] 프로필 API 연동
   3. [ ] 라우트 등록
   4. [ ] 테스트 코드 작성

   ### 승인 요청
   위 계획을 진행해도 될까요?
   ```

### 1.3 사용자 승인

| 응답 | 결과 |
|------|------|
| 승인 (Y) | Coder Agent로 진행 |
| 수정 요청 | 계획 수정 후 재제출 |
| 거부 (N) | 작업 종료 |

### 1.4 Coder Agent 실행

```
[계획 1/4] 프로필 페이지 컴포넌트 생성
→ src/pages/profile.tsx 작성

[계획 2/4] 프로필 API 연동
→ API 호출 로직 구현

[계획 3/4] 라우트 등록
→ src/routes/index.ts 수정

[계획 4/4] 테스트 코드 작성
→ src/pages/__tests__/profile.test.tsx 작성
```

### 1.5 자동 검증

```bash
npm run type-check  # 타입 체크
npm run lint        # 린트 검사
npm test            # 테스트 실행
```

### 1.6 Reviewer Agent 리뷰

```markdown
## 코드 리뷰 결과

### 품질 점수: 85/100

### 긍정적 요소
- 타입 정의가 명확함
- 테스트 커버리지 충분

### 개선 필요
- [ ] 에러 처리 보완 필요 (line 45)
- [ ] 로딩 상태 UI 개선 권장

### 보안 검사: 통과
### 성능 검사: 통과
```

### 1.7 커밋 및 PR

```bash
git add -A
git commit -m "feat(profile): 사용자 프로필 페이지 추가"
git push origin feature/profile-page
```

---

## 2. Bug Fix Workflow

버그를 수정할 때의 워크플로우입니다.

### 2.1 버그 리포트

```
사용자: "로그인 시 간헐적으로 세션이 만료됩니다"
```

### 2.2 Planner Agent - 분석

1. **증상 분석**
   - 에러 로그 확인
   - 재현 조건 파악

2. **원인 추적**
   - 관련 코드 탐색
   - 히스토리 확인

3. **수정 계획**
   ```markdown
   ## 버그 수정 계획

   ### 문제
   세션 토큰 갱신 로직에서 race condition 발생

   ### 원인
   동시 요청 시 토큰 갱신이 중복 발생

   ### 수정 방안
   1. 토큰 갱신 로직에 mutex 적용
   2. 갱신 중 요청 대기 처리

   ### 영향 파일
   - src/services/auth.ts
   - src/utils/token.ts
   ```

### 2.3 수정 및 검증

```
1. Coder Agent 수정 적용
2. 기존 테스트 통과 확인
3. 버그 재현 테스트 추가
4. Reviewer Agent 리뷰
```

---

## 3. Self-healing Workflow

테스트 실패 시 자동 수정 흐름입니다.

### 3.1 트리거

```
[자동 검증 실패]
- 테스트 3개 실패
- 린트 에러 2개
```

### 3.2 에러 분석

```markdown
## 에러 분석 결과

### 테스트 실패
1. `user.test.ts:45` - 예상값 불일치
   - 예상: { status: 'active' }
   - 실제: { status: 'pending' }

2. `auth.test.ts:23` - 타임아웃
   - API 모킹 누락

### 린트 에러
1. `profile.tsx:12` - unused variable
2. `api.ts:34` - missing return type
```

### 3.3 자동 수정 시도

```
[시도 1/3]
- 테스트 기대값 수정
- 미사용 변수 제거
- 타입 추가

[재검증]
→ 2개 통과, 1개 실패

[시도 2/3]
- API 모킹 추가

[재검증]
→ 모두 통과
```

### 3.4 실패 시 에스컬레이션

```markdown
## 자동 수정 실패 알림

3회 시도 후에도 다음 오류가 해결되지 않았습니다:

### 미해결 이슈
- `integration.test.ts:78` - 외부 API 타임아웃

### 필요 조치
- 외부 API 상태 확인
- 환경 변수 검증

### 사용자 개입 요청
위 이슈를 확인해주세요.
```

---

## 4. Approval Flow

승인 체계 상세입니다.

### 4.1 승인 레벨

| 레벨 | 대상 | 승인자 | 자동화 |
|------|------|--------|--------|
| L1 | 일반 변경 | 시스템 | 테스트 통과 시 자동 승인 |
| L2 | 아키텍처 변경 | 사용자 | 명시적 승인 필요 |
| L3 | 보안 변경 | 사용자 + AI | 이중 검증 |
| L4 | 프로덕션 배포 | 사용자 + 관리자 | 수동 승인 |

### 4.2 승인 요청 형식

```markdown
## 승인 요청

### 변경 유형: L2 (아키텍처 변경)

### 변경 내용
데이터베이스 스키마 변경
- users 테이블에 role 컬럼 추가
- 마이그레이션 스크립트 포함

### 영향 범위
- 기존 데이터 마이그레이션 필요
- 관련 API 응답 형식 변경

### 롤백 계획
- 마이그레이션 롤백 스크립트 포함
- 이전 버전 호환성 유지

### 승인 선택
[ ] 승인 - 진행합니다
[ ] 조건부 승인 - 수정 후 진행
[ ] 거부 - 중단합니다
```

---

## 5. Documentation Workflow

문서 자동 생성 흐름입니다.

### 5.1 트리거

- 코드 변경 완료 후
- `/docs` 명령 실행 시
- PR 생성 시

### 5.2 생성 항목

```markdown
## 자동 생성 문서

### 코드 변경에 따른 업데이트
1. API 문서
   - 새 엔드포인트 추가
   - 응답 형식 변경

2. 타입 문서
   - 새 인터페이스 정의

3. 변경 로그
   - CHANGELOG.md 업데이트
```

---

## 6. Emergency Workflow

긴급 상황 대응 흐름입니다.

### 6.1 긴급 핫픽스

```
1. 문제 인지
   ↓
2. 즉시 분석 (Planner)
   - 최소 범위 파악
   - 빠른 수정안 도출
   ↓
3. 간소화된 승인
   - L1 자동 승인
   - L2+ 긴급 연락
   ↓
4. 핫픽스 적용
   - 최소 변경
   - 필수 테스트만
   ↓
5. 즉시 배포
   ↓
6. 사후 정리
   - 전체 테스트
   - 문서 업데이트
   - 근본 원인 분석
```

---

## Workflow Commands

| 명령어 | 워크플로우 |
|--------|-----------|
| `/plan` | 계획 수립 시작 |
| `/implement` | 구현 시작 (승인된 계획) |
| `/review` | 코드 리뷰 실행 |
| `/test` | 테스트 실행 |
| `/commit` | 커밋 생성 |
| `/deploy` | 배포 실행 |
| `/docs` | 문서 생성 |

---

## Related Documents

- [CLAUDE.md](../CLAUDE.md) - 핵심 규칙
- [Architecture](./architecture.md) - 시스템 구조
- [Conventions](./conventions.md) - 코딩 규칙
