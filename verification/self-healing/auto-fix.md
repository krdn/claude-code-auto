# Self-Healing 자동 수정 가이드

> CI 실패 시 자동 복구 시스템

---

## Overview

Self-healing 시스템은 CI 파이프라인 실패 시 자동으로 문제를 분석하고 수정을 시도합니다.

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        Self-Healing Flow                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   CI 실패                                                                │
│      ↓                                                                   │
│   에러 분석                                                              │
│      ↓                                                                   │
│   ┌─────────────────────────────────────────┐                           │
│   │ 자동 수정 가능?                          │                           │
│   ├───────────────┬─────────────────────────┤                           │
│   │      Yes      │          No             │                           │
│   │      ↓        │          ↓              │                           │
│   │  자동 수정    │    이슈 생성            │                           │
│   │      ↓        │          ↓              │                           │
│   │  재검증      │    사용자 알림           │                           │
│   │      ↓        │                         │                           │
│   │  성공? ──No──→ 재시도 (최대 3회)        │                           │
│   │      ↓ Yes    │          ↓              │                           │
│   │  완료        │    실패 시 이슈 생성     │                           │
│   └───────────────┴─────────────────────────┘                           │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 자동 수정 가능한 에러 유형

### 1. Lint 에러 (ESLint)

**자동 수정 가능:**
- 코드 스타일 (들여쓰기, 세미콜론, 따옴표)
- 사용하지 않는 import 제거
- 간단한 규칙 위반

**수정 명령:**
```bash
npm run lint:fix
```

**예시:**
```
Before: const x = 1
After:  const x = 1;
```

---

### 2. 포맷 에러 (Prettier)

**자동 수정 가능:**
- 모든 포맷팅 이슈
- 줄바꿈, 공백
- 코드 정렬

**수정 명령:**
```bash
npm run format
```

---

### 3. Import 정렬

**자동 수정 가능:**
- Import 순서 정렬
- 중복 import 제거

**수정 명령:**
```bash
npm run lint:fix
```

---

## 자동 수정 불가능한 에러

### 1. 타입 에러 (TypeScript)

**이유:** 타입 에러는 로직 변경이 필요하여 자동 수정이 위험함

**처리:**
- 이슈 자동 생성
- 에러 위치 및 메시지 포함
- 사용자 수정 필요

---

### 2. 테스트 실패

**이유:** 테스트 실패는 비즈니스 로직 문제이므로 자동 수정 불가

**처리:**
- 이슈 자동 생성
- 실패한 테스트 목록 포함
- 사용자 분석 필요

---

### 3. 빌드 에러

**이유:** 빌드 에러는 구조적 문제이므로 자동 수정 불가

**처리:**
- 이슈 자동 생성
- 빌드 로그 포함
- 사용자 분석 필요

---

## 재시도 정책

| 설정 | 값 | 설명 |
|------|-----|------|
| MAX_RETRIES | 3 | 최대 재시도 횟수 |
| RETRY_DELAY | 10s | 재시도 간 대기 시간 |
| TIMEOUT | 5min | 전체 타임아웃 |

---

## 워크플로우 설정

### GitHub Actions 트리거

```yaml
on:
  workflow_run:
    workflows: ["CI Pipeline"]
    types: [completed]
```

### 에러 분석 로직

```yaml
- name: Analyze error type
  run: |
    if echo "$ERROR_INFO" | grep -q "lint"; then
      echo "error_type=lint" >> $GITHUB_OUTPUT
      echo "should_fix=true" >> $GITHUB_OUTPUT
    elif echo "$ERROR_INFO" | grep -q "type"; then
      echo "error_type=type" >> $GITHUB_OUTPUT
      echo "should_fix=false" >> $GITHUB_OUTPUT
    elif echo "$ERROR_INFO" | grep -q "test"; then
      echo "error_type=test" >> $GITHUB_OUTPUT
      echo "should_fix=false" >> $GITHUB_OUTPUT
    fi
```

---

## 수동 트리거

Self-healing을 수동으로 트리거할 수 있습니다:

### GitHub Actions UI

1. Actions 탭으로 이동
2. "Self-healing Loop" 워크플로우 선택
3. "Run workflow" 클릭
4. 선택적으로 이슈 번호 입력

### CLI

```bash
gh workflow run self-healing.yml
```

---

## 이슈 생성 형식

자동 수정 실패 시 다음 형식으로 이슈가 생성됩니다:

```markdown
## Self-healing 실패

자동 수정을 시도했으나 해결되지 않았습니다.

### 에러 유형
`lint`

### 상세 정보
```json
[{"name": "Lint", "steps": ["Run ESLint"]}]
```

### 필요 조치
- [ ] 에러 원인 분석
- [ ] 수동 수정 적용
- [ ] 재테스트

---
🤖 Auto-generated by Self-healing workflow
```

---

## 로컬 검증 스크립트

### 테스트 실행

```bash
./verification/test-runner.sh
```

### 린트 검사

```bash
./verification/lint-check.sh

# 자동 수정 모드
./verification/lint-check.sh --fix
```

---

## 모니터링

### 성공률 추적

| 지표 | 목표 |
|------|------|
| Self-healing 성공률 | > 80% |
| 평균 수정 시간 | < 2분 |
| 재시도 필요 횟수 | < 1.5회 |

### 알림 설정

실패 시 다음 채널로 알림:
- GitHub Issue 생성
- (선택) Slack 알림
- (선택) 이메일 알림

---

## 트러블슈팅

### 자동 수정이 적용되지 않는 경우

1. **권한 확인**: `GITHUB_TOKEN`에 push 권한이 있는지 확인
2. **브랜치 보호**: 보호된 브랜치에는 자동 커밋 불가
3. **충돌**: 다른 커밋과 충돌 시 자동 수정 실패

### 무한 루프 방지

- 자동 수정 커밋에는 `[skip ci]` 태그 고려
- MAX_RETRIES 제한으로 무한 루프 방지
- 동일 에러 반복 시 이슈 생성

---

## 관련 파일

| 파일 | 용도 |
|------|------|
| `.github/workflows/ci.yml` | CI 파이프라인 |
| `.github/workflows/self-healing.yml` | Self-healing 워크플로우 |
| `verification/test-runner.sh` | 테스트 실행 스크립트 |
| `verification/lint-check.sh` | 린트 검사 스크립트 |

---

## 관련 문서

- [[Feature-Development-Workflow]] - 기능 개발 워크플로우
- [[Workflow]] - 전체 워크플로우 가이드
- [[CLAUDE]] - 핵심 규칙
