name: AI Code Review

on:
  pull_request:
    types: [opened, synchronize]

permissions:
  contents: read
  pull-requests: write
  issues: write
  id-token: write

jobs:
  ai-review:
    name: AI Code Review
    runs-on: ubuntu-latest
    # AI ë¦¬ë·°ëŠ” Draft PRì´ë‚˜ ë´‡ PRì—ì„œëŠ” ì‹¤í–‰í•˜ì§€ ì•ŠìŒ
    if: >
      github.event.pull_request.draft == false &&
      !contains(github.event.pull_request.user.login, 'bot') &&
      !contains(github.event.pull_request.user.login, '[bot]')

    steps:
      - name: Checkout
        uses: actions/checkout@v6
        with:
          fetch-depth: 0

      - name: Get Changed Files
        id: changed-files
        uses: tj-actions/changed-files@v44
        with:
          files: |
            **/*.ts
            **/*.tsx
            **/*.js
            **/*.jsx

      - name: AI Review with Claude (OAuth)
        if: steps.changed-files.outputs.any_changed == 'true'
        uses: anthropics/claude-code-action@beta
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          timeout_minutes: "10"
          direct_prompt: |
            ì´ PRì˜ ì½”ë“œ ë³€ê²½ì‚¬í•­ì„ ë¦¬ë·°í•´ì£¼ì„¸ìš”. í•œêµ­ì–´ë¡œ ê°„ê²°í•˜ê²Œ ë‹µë³€í•˜ê³ , ë‹¤ìŒ í•­ëª©ì— ì§‘ì¤‘í•´ì£¼ì„¸ìš”:

            1. ğŸ› ë²„ê·¸ ê°€ëŠ¥ì„±
            2. ğŸ”’ ë³´ì•ˆ ì´ìŠˆ
            3. âš¡ ì„±ëŠ¥ ë¬¸ì œ
            4. âœ¨ ì½”ë“œ í’ˆì§ˆ ê°œì„ ì 

            ê° í•­ëª©ì— í•´ë‹¹ì‚¬í•­ì´ ì—†ìœ¼ë©´ ìƒëµí•˜ê³ , ìˆìœ¼ë©´ êµ¬ì²´ì ì¸ íŒŒì¼ ìœ„ì¹˜ì™€ ê°œì„  ë°©ì•ˆì„ ì œì‹œí•´ì£¼ì„¸ìš”.
            ì „ë°˜ì ìœ¼ë¡œ ì˜ ì‘ì„±ëœ ì½”ë“œë¼ë©´ ì¹­ì°¬ë„ í•´ì£¼ì„¸ìš”.

      - name: Skip Notice
        if: steps.changed-files.outputs.any_changed != 'true'
        run: |
          echo "No TypeScript/JavaScript files changed, skipping AI review"
